<!doctype html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weekend-ondersteuning</title>

    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <!-- Babel (zodat JSX in de browser werkt) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>

  <body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      // --- ISO week helpers (no deps) ---
      function isoWeekYearAndNumber(date) {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7; // Mon=1..Sun=7
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);

        const isoYear = d.getUTCFullYear();

        const yearStart = new Date(Date.UTC(isoYear, 0, 1));
        const yearStartDay = yearStart.getUTCDay() || 7;
        const week1Start = new Date(yearStart);
        week1Start.setUTCDate(
          yearStart.getUTCDate() + (yearStartDay <= 4 ? 1 - yearStartDay : 8 - yearStartDay)
        );

        const diffMs = d.getTime() - week1Start.getTime();
        const weekNo = 1 + Math.round(diffMs / (7 * 24 * 60 * 60 * 1000));
        return { isoYear, weekNo };
      }

      function isEven(n) {
        return n % 2 === 0;
      }

      function startOfWeekendForIsoWeek(isoYear, weekNo) {
        const jan4 = new Date(isoYear, 0, 4);
        const jan4Day = jan4.getDay() || 7;
        const mondayWeek1 = new Date(jan4);
        mondayWeek1.setDate(jan4.getDate() - (jan4Day - 1));

        const monday = new Date(mondayWeek1);
        monday.setDate(mondayWeek1.getDate() + (weekNo - 1) * 7);

        const saturday = new Date(monday);
        saturday.setDate(monday.getDate() + 5);
        return saturday;
      }

      function fmtDate(d) {
        return d.toLocaleDateString(undefined, {
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      function clampInt(v, fallback) {
        const n = parseInt(String(v), 10);
        return Number.isFinite(n) ? n : fallback;
      }

      function parityIndexFromAnchor(anchorYear, anchorWeek, currentYear, currentWeek, parity) {
        const a = startOfWeekendForIsoWeek(anchorYear, anchorWeek);
        const c = startOfWeekendForIsoWeek(currentYear, currentWeek);

        const diffWeeks = Math.round((c.getTime() - a.getTime()) / (7 * 24 * 60 * 60 * 1000));
        const steps = diffWeeks < 0 ? 0 : diffWeeks;

        let count = 0;
        const max = Math.min(steps, 520);

        for (let i = 0; i <= max; i++) {
          const dt = new Date(a);
          dt.setDate(a.getDate() + i * 7);
          const { weekNo } = isoWeekYearAndNumber(dt);
          const matches = (parity === "even" && isEven(weekNo)) || (parity === "odd" && !isEven(weekNo));
          if (matches) count++;
        }

        return Math.max(0, count - 1);
      }

      const LS_KEY = "weekend_support_roster_v1";

      function App() {
        const evenSupport = useMemo(
          () => ({
            duty: "IC dienst",
            primary: "Jerico",
            note: "Andre is langdurig ziek",
            supporters: ["Younes", "Tim"],
            label: "Even weken",
          }),
          []
        );

        const oddSupport = useMemo(
          () => ({
            duty: "IC dienst",
            primary: "Grada",
            supporters: ["Lion", "Mille"],
            label: "Oneven weken",
          }),
          []
        );

        const today = new Date();
        const { isoYear, weekNo } = isoWeekYearAndNumber(today);
        const parity = isEven(weekNo) ? "even" : "odd";

        const [settings, setSettings] = useState(() => {
          try {
            const raw = localStorage.getItem(LS_KEY);
            if (!raw) {
              return {
                evenAnchorYear: isoYear,
                evenAnchorWeek: 2,
                oddAnchorYear: isoYear,
                oddAnchorWeek: 1,
              };
            }
            const s = JSON.parse(raw);
            return {
              evenAnchorYear: clampInt(s.evenAnchorYear, isoYear),
              evenAnchorWeek: clampInt(s.evenAnchorWeek, 2),
              oddAnchorYear: clampInt(s.oddAnchorYear, isoYear),
              oddAnchorWeek: clampInt(s.oddAnchorWeek, 1),
            };
          } catch {
            return {
              evenAnchorYear: isoYear,
              evenAnchorWeek: 2,
              oddAnchorYear: isoYear,
              oddAnchorWeek: 1,
